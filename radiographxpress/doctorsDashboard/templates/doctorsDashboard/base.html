{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>{% block title %}Radiograph Xpress{% endblock %}</title>
    <!-- Use the local app css -->
    <link rel="stylesheet" href="{% static 'core/css/design-system.css' %}">
    <link rel="stylesheet" href="{% static 'doctorsDashboard/style.css' %}">
    {% block head %}{% endblock %}
</head>

<body>
    <header>
        <nav class="navbar">
            <!-- Left: Logo -->
            <div class="navbar-left">
                <img src="{% static 'core/assets/img/logos/radiographxpress_logo.png' %}" alt="Radiograph Xpress"
                    class="navbar-logo">
            </div>

            <!-- Center: Navigation Links -->
            <div class="navbar-center">
                <ul class="nav-links">
                    <li><a href="{% url 'pendingStudies' %}" class="nav-link">Estudios Pendientes</a></li>
                    <li><a href="{% url 'studiesInProgress' %}" class="nav-link">Estudios en Progreso</a></li>
                </ul>
            </div>

            <!-- Right: User Info -->
            <div class="navbar-right">
                <!-- Use a custom logout view that handles cleanup -->
                <a href="{% url 'doctor_logout' %}" class="nav-link" id="logoutBtn">Cerrar Sesión</a>
                <a href="{% url 'myProfile' %}" class="user-info" style="text-decoration: none;">
                    <span class="welcome-text">Bienvenido, Dr. {{ reporting_doctor.last_name }}</span>
                    <img src="https://placehold.co/35x35" alt="Profile" class="user-avatar">
                </a>
            </div>
        </nav>
        {% block header %}{% endblock %}
    </header>

    <script>
        document.getElementById('logoutBtn').addEventListener('click', function (e) {
            let hasDrafts = false;
            // Check for any drafts in localStorage
            for (let i = 0; i < localStorage.length; i++) {
                if (localStorage.key(i).startsWith('draft_study_')) {
                    hasDrafts = true;
                    break;
                }
            }

            if (hasDrafts) {
                if (!confirm("Tiene reportes en progreso. Si cierra sesión, se perderá el progreso no guardado. ¿Desea continuar?")) {
                    e.preventDefault();
                    return;
                }
            }

            // Clear drafts if proceeding (or if no drafts existed but user clicked logout)
            // We clear ALL drafts to ensure clean slate, as backend will delete the locks.
            const keysToRemove = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('draft_study_')) {
                    keysToRemove.push(key);
                }
            }
            keysToRemove.forEach(key => localStorage.removeItem(key));
        });
    </script>

    <main>
        {% block content %}
        {% endblock %}
    </main>

    <footer>
        <!-- Footer content if needed later -->
    </footer>
</body>

</html>